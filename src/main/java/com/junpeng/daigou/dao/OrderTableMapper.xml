<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.junpeng.daigou.dao.OrderTableMapper" >
  <resultMap id="BaseResultMap" type="com.junpeng.daigou.model.OrderTable" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="idorder" jdbcType="INTEGER" property="idorder" />
    <result column="idcustomer" jdbcType="INTEGER" property="idcustomer" />
    <result column="bookdate" jdbcType="TIMESTAMP" property="bookdate" />
    <result column="deposit" jdbcType="DOUBLE" property="deposit" />
    <result column="payment" jdbcType="DOUBLE" property="payment" />
    <result column="deposittype" jdbcType="VARCHAR" property="deposittype" />
    <result column="paymenttype" jdbcType="VARCHAR" property="paymenttype" />
    <result column="postprice" jdbcType="DOUBLE" property="postprice" />
    <result column="remaindprice" jdbcType="DOUBLE" property="remaindprice" />
    <result column="sumprofit" jdbcType="DOUBLE" property="sumprofit" />
    <result column="sumprice" jdbcType="DOUBLE" property="sumprice" />
    <result column="status" jdbcType="VARCHAR" property="status" />
  </resultMap>
  <sql id="Example_Where_Clause" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <where>
      <foreach collection="oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <where>
      <foreach collection="example.oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    idorder, idcustomer, bookdate, deposit, payment, deposittype, paymenttype, postprice, 
    remaindprice, sumprofit, sumprice, status
  </sql>
  <select id="selectByExample" parameterType="com.junpeng.daigou.model.OrderTableExample" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <if test="distinct" >
      distinct
    </if>
    'true' as QUERYID,
    <include refid="Base_Column_List" />
    from ordertable
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null" >
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from ordertable
    where idorder = #{idorder,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from ordertable
    where idorder = #{idorder,jdbcType=INTEGER}
  </delete>
  <delete id="deleteByExample" parameterType="com.junpeng.daigou.model.OrderTableExample" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from ordertable
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="com.junpeng.daigou.model.OrderTable" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into ordertable (idorder, idcustomer, bookdate, 
      deposit, payment, deposittype, 
      paymenttype, postprice, remaindprice, 
      sumprofit, sumprice, status
      )
    values (#{idorder,jdbcType=INTEGER}, #{idcustomer,jdbcType=INTEGER}, #{bookdate,jdbcType=TIMESTAMP}, 
      #{deposit,jdbcType=DOUBLE}, #{payment,jdbcType=DOUBLE}, #{deposittype,jdbcType=VARCHAR}, 
      #{paymenttype,jdbcType=VARCHAR}, #{postprice,jdbcType=DOUBLE}, #{remaindprice,jdbcType=DOUBLE}, 
      #{sumprofit,jdbcType=DOUBLE}, #{sumprice,jdbcType=DOUBLE}, #{status,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.junpeng.daigou.model.OrderTable" >
      <selectKey resultType="java.lang.Integer" order="AFTER" keyProperty="idorder">
SELECT LAST_INSERT_ID() AS idorder
</selectKey>
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into ordertable
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="idorder != null" >
        idorder,
      </if>
      <if test="idcustomer != null" >
        idcustomer,
      </if>
      <if test="bookdate != null" >
        bookdate,
      </if>
      <if test="deposit != null" >
        deposit,
      </if>
      <if test="payment != null" >
        payment,
      </if>
      <if test="deposittype != null" >
        deposittype,
      </if>
      <if test="paymenttype != null" >
        paymenttype,
      </if>
      <if test="postprice != null" >
        postprice,
      </if>
      <if test="remaindprice != null">
        remaindprice,
      </if>
      <if test="sumprofit != null">
        sumprofit,
      </if>
      <if test="sumprice != null">
        sumprice,
      </if>
      <if test="status != null">
        status,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="idorder != null" >
        #{idorder,jdbcType=INTEGER},
      </if>
      <if test="idcustomer != null" >
        #{idcustomer,jdbcType=INTEGER},
      </if>
      <if test="bookdate != null" >
        #{bookdate,jdbcType=TIMESTAMP},
      </if>
      <if test="deposit != null">
        #{deposit,jdbcType=DOUBLE},
      </if>
      <if test="payment != null">
        #{payment,jdbcType=DOUBLE},
      </if>
      <if test="deposittype != null" >
        #{deposittype,jdbcType=VARCHAR},
      </if>
      <if test="paymenttype != null" >
        #{paymenttype,jdbcType=VARCHAR},
      </if>
      <if test="postprice != null">
        #{postprice,jdbcType=DOUBLE},
      </if>
      <if test="remaindprice != null">
        #{remaindprice,jdbcType=DOUBLE},
      </if>
      <if test="sumprofit != null">
        #{sumprofit,jdbcType=DOUBLE},
      </if>
      <if test="sumprice != null">
        #{sumprice,jdbcType=DOUBLE},
      </if>
      <if test="status != null" >
        #{status,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="com.junpeng.daigou.model.OrderTableExample" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select count(*) from ordertable
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update ordertable
    <set >
      <if test="record.idorder != null" >
        idorder = #{record.idorder,jdbcType=INTEGER},
      </if>
      <if test="record.idcustomer != null" >
        idcustomer = #{record.idcustomer,jdbcType=INTEGER},
      </if>
      <if test="record.bookdate != null" >
        bookdate = #{record.bookdate,jdbcType=TIMESTAMP},
      </if>
      <if test="record.deposit != null">
        deposit = #{record.deposit,jdbcType=DOUBLE},
      </if>
      <if test="record.payment != null">
        payment = #{record.payment,jdbcType=DOUBLE},
      </if>
      <if test="record.deposittype != null" >
        deposittype = #{record.deposittype,jdbcType=VARCHAR},
      </if>
      <if test="record.paymenttype != null" >
        paymenttype = #{record.paymenttype,jdbcType=VARCHAR},
      </if>
      <if test="record.postprice != null">
        postprice = #{record.postprice,jdbcType=DOUBLE},
      </if>
      <if test="record.remaindprice != null">
        remaindprice = #{record.remaindprice,jdbcType=DOUBLE},
      </if>
      <if test="record.sumprofit != null">
        sumprofit = #{record.sumprofit,jdbcType=DOUBLE},
      </if>
      <if test="record.sumprice != null">
        sumprice = #{record.sumprice,jdbcType=DOUBLE},
      </if>
      <if test="record.status != null">
        status = #{record.status,jdbcType=VARCHAR},
      </if>
    </set>
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update ordertable
    set idorder = #{record.idorder,jdbcType=INTEGER},
      idcustomer = #{record.idcustomer,jdbcType=INTEGER},
      bookdate = #{record.bookdate,jdbcType=TIMESTAMP},
      deposit = #{record.deposit,jdbcType=DOUBLE},
      payment = #{record.payment,jdbcType=DOUBLE},
      deposittype = #{record.deposittype,jdbcType=VARCHAR},
      paymenttype = #{record.paymenttype,jdbcType=VARCHAR},
      postprice = #{record.postprice,jdbcType=DOUBLE},
      remaindprice = #{record.remaindprice,jdbcType=DOUBLE},
      sumprofit = #{record.sumprofit,jdbcType=DOUBLE},
      sumprice = #{record.sumprice,jdbcType=DOUBLE},
      status = #{record.status,jdbcType=VARCHAR}
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="com.junpeng.daigou.model.OrderTable" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update ordertable
    <set >
      <if test="idcustomer != null" >
        idcustomer = #{idcustomer,jdbcType=INTEGER},
      </if>
      <if test="bookdate != null" >
        bookdate = #{bookdate,jdbcType=TIMESTAMP},
      </if>
      <if test="deposit != null">
        deposit = #{deposit,jdbcType=DOUBLE},
      </if>
      <if test="payment != null">
        payment = #{payment,jdbcType=DOUBLE},
      </if>
      <if test="deposittype != null" >
        deposittype = #{deposittype,jdbcType=VARCHAR},
      </if>
      <if test="paymenttype != null" >
        paymenttype = #{paymenttype,jdbcType=VARCHAR},
      </if>
      <if test="postprice != null">
        postprice = #{postprice,jdbcType=DOUBLE},
      </if>
      <if test="remaindprice != null">
        remaindprice = #{remaindprice,jdbcType=DOUBLE},
      </if>
      <if test="sumprofit != null">
        sumprofit = #{sumprofit,jdbcType=DOUBLE},
      </if>
      <if test="sumprice != null">
        sumprice = #{sumprice,jdbcType=DOUBLE},
      </if>
      <if test="status != null">
        status = #{status,jdbcType=VARCHAR},
      </if>
    </set>
    where idorder = #{idorder,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.junpeng.daigou.model.OrderTable" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update ordertable
    set idcustomer = #{idcustomer,jdbcType=INTEGER},
      bookdate = #{bookdate,jdbcType=TIMESTAMP},
      deposit = #{deposit,jdbcType=DOUBLE},
      payment = #{payment,jdbcType=DOUBLE},
      deposittype = #{deposittype,jdbcType=VARCHAR},
      paymenttype = #{paymenttype,jdbcType=VARCHAR},
      postprice = #{postprice,jdbcType=DOUBLE},
      remaindprice = #{remaindprice,jdbcType=DOUBLE},
      sumprofit = #{sumprofit,jdbcType=DOUBLE},
      sumprice = #{sumprice,jdbcType=DOUBLE},
      status = #{status,jdbcType=VARCHAR}
    where idorder = #{idorder,jdbcType=INTEGER}
  </update>
  <select id="getOrderByCustomerAndStatus" resultType="com.junpeng.daigou.model.OrderTable">
	SELECT 
	    idorder,
	    o.idcustomer,
	    c.customername,
	    c.wxid,
	    bookdate,
	    deposit,
	    deposittype,
	    payment,
	    paymenttype,
	    postprice,
	    remaindprice,
	    sumprofit,
	    sumprice,
	    s.statuscode as status,
        s.statusvalue as statusStr
	    
	FROM
	    orderTable o,
	    customer c,
	    status s
	WHERE
	    o.idcustomer = c.idcustomer
	    and s.statuscode = o.status
	    and s.statustype=1
	  <if test="idcustomer != null and idcustomer != 0" >
	    and c.idcustomer = #{idcustomer,jdbcType=INTEGER}
	  </if>
	  <if test="status != null and status != '' " >
	    and o.status = #{status,jdbcType=VARCHAR}
	  </if>
	   <if test="idorder != null and idorder != 0" >
	    and idorder = #{idorder,jdbcType=VARCHAR}
	  </if>
	  order by status asc,bookdate asc
  </select>
  
  <select id="getOrderByOrderId" resultType="com.junpeng.daigou.model.OrderDetail">
	SELECT 
	    od.*,
	    o.idorder,
	    p.idproduct,
	    p.productname,
	    p.productnamejapan,
	    o.idcustomer,
	    c.customername,
        s.statusvalue
	FROM
	    orderdetail od,
	    ordertable o,
	    product p,
	    customer c,
	    status s
	WHERE
	    od.idorder = o.idorder
        AND p.idproduct = od.idproduct
        and o.idcustomer = c.idcustomer
        and od.status=s.statuscode
        and s.statustype=2
	   <if test="idorder != null and idorder != 0" >
        AND o.idorder = #{idorder,jdbcType=INTEGER}
       </if>
       <if test="idorderdetail != null and idorderdetail != 0" >
	    and idorderdetail = #{idorderdetail,jdbcType=INTEGER}
	  </if>
	  <if test="idcustomer != null and idcustomer != 0" >
	    and o.idcustomer = #{idcustomer,jdbcType=INTEGER}
	  </if>
	  <if test="idproduct != null and idproduct != 0" >
	    and od.idproduct = #{idproduct,jdbcType=INTEGER}
	  </if>
	  <if test="status != null and status != '' " >
	    and od.status = #{status,jdbcType=VARCHAR}
	  </if>
	  order by o.status asc,od.status asc,o.bookdate asc,od.bookdate asc
</select>
<update id="udpateSumprofit" parameterType="java.lang.Integer" >
	UPDATE ordertable 
	SET 
	    sumprofit = (SELECT 
	            IFNULL(SUM(profit),0)
	        FROM
	            daigou.orderdetail
	        WHERE
	            idorder = #{idorder,jdbcType=VARCHAR})
	WHERE
	    idorder = #{idorder,jdbcType=VARCHAR}
</update>

<update id="updateSumprice" parameterType="java.lang.Integer" >
	UPDATE ordertable 
	SET 
	    sumprice = (SELECT 
	            IFNULL(SUM(bookprice * count) ,0) + postprice
	        FROM
	            daigou.orderdetail
	        WHERE
	            idorder = #{idorder,jdbcType=VARCHAR})
	WHERE
	    idorder = #{idorder,jdbcType=VARCHAR}
</update>
</mapper>